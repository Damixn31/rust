# La pila y el monton

- Muchos lenguajes de programación no requieren que pienses en la pila y el montón muy a menudo. Pero en un lenguaje de programación de sistemas como Rust, si un valor está en la pila o en el montón afecta a cómo se comporta el lenguaje y por qué tienes que tomar ciertas decisiones. Partes de la propiedad serán descritas en relación a la pila y el montón.

- Tanto la pila como el montón son partes de memoria disponibles para que tu código las use en tiempo de ejecución, pero están estructuradas de formas diferentes. La pila almacena valores en el orden en que los obtiene y los elimina en el orden opuesto. Esto se conoce como último en entrar, primero en salir. Piensa en una pila de platos: cuando añades más platos, los pones encima de la pila, y cuando necesitas un plato, coges uno de la parte superior. Añadir o quitar platos del medio o del fondo no funcionaría tan bien. Añadir datos se llama empujar a la pila, y quitar datos se llama sacar de la pila. Todos los datos almacenados en la pila deben tener un tamaño fijo conocido. Los datos con un tamaño desconocido en tiempo de compilación o un tamaño que pueda cambiar deben almacenarse en el montón.

- El montón está menos organizado: cuando pones datos en el montón, solicitas una cierta cantidad de espacio. El asignador de memoria encuentra un lugar vacío en el montón que sea lo suficientemente grande, lo marca como en uso y devuelve un puntero, que es la dirección de esa ubicación. Este proceso se denomina asignar en el montón y a veces se abrevia como simplemente asignar (introducir valores en la pila no se considera asignar). Como el puntero al montón tiene un tamaño fijo y conocido, puedes almacenarlo en la pila, pero cuando quieras los datos reales, debes seguir el puntero. Piense en sentarse en un restaurante. Cuando entras, indicas el número de personas de tu grupo y el anfitrión busca una mesa vacía en la que quepan todos y te lleva allí. Si alguien de tu grupo llega tarde, puede preguntar dónde te han sentado para encontrarte.

- Empujar a la pila es más rápido que asignar en el montón porque el asignador nunca tiene que buscar un lugar para almacenar nuevos datos; esa ubicación siempre está en la parte superior de la pila. Comparativamente, la asignación de espacio en el montón requiere más trabajo porque el asignador debe encontrar primero un espacio lo suficientemente grande para almacenar los datos y luego realizar la contabilidad para preparar la siguiente asignación.

- Acceder a los datos del montón es más lento que hacerlo a los de la pila, porque hay que seguir un puntero para llegar a ellos. Los procesadores actuales son más rápidos si saltan menos en la memoria. Siguiendo con la analogía, pensemos en el camarero de un restaurante que toma pedidos de muchas mesas. Lo más eficiente es tomar todos los pedidos de una mesa antes de pasar a la siguiente. Tomar un pedido de la mesa A, otro de la B, otro de la A y otro de la B sería un proceso mucho más lento. Del mismo modo, un procesador puede hacer mejor su trabajo si trabaja con datos que están cerca de otros datos (como ocurre en la pila) en lugar de más lejos (como puede ocurrir en el montón).

- Cuando tu código llama a una función, los valores pasados a la función (incluyendo, potencialmente, punteros a datos del montón) y las variables locales de la función se colocan en la pila. Cuando la función finaliza, esos valores salen de la pila.

- Hacer un seguimiento de qué partes del código están utilizando qué datos en el montón, minimizar la cantidad de datos duplicados en el montón y limpiar los datos no utilizados en el montón para que no te quedes sin espacio son todos problemas que aborda la propiedad. Una vez que entiendas la propiedad, no necesitarás pensar en la pila y el montón muy a menudo, pero saber que el propósito principal de la propiedad es gestionar los datos del montón puede ayudar a explicar por qué funciona de la forma en que lo hace.
